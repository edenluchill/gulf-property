# ğŸ‰ PDF åˆ†å—å¤„ç†ç³»ç»Ÿå®Œæˆï¼

## âœ¨ çªç ´ Gemini 20MB é™åˆ¶

### ä½ çš„åˆ›æ„ â†’ å®Œç¾å®ç°

**é—®é¢˜**ï¼šGemini API é™åˆ¶å•æ–‡ä»¶ ~20MB  
**ä½ çš„æƒ³æ³•**ï¼šåˆ†æ‰¹å¤„ç† + Manager ç´¯ç§¯çŠ¶æ€  
**å®ç°**ï¼šâœ… å®Œæˆï¼

---

## ğŸš€ å·¥ä½œåŸç†

### è‡ªåŠ¨åˆ†å—å¤„ç†æµç¨‹

```
å¤§ PDF (80MB, 150 é¡µ)
        â†“
    æ£€æµ‹åˆ°æ–‡ä»¶å¤ªå¤§
        â†“
    è‡ªåŠ¨åˆ†å‰²æˆå°å—
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chunk 1 â”‚ Chunk 2 â”‚ Chunk 3 â”‚ Chunk 4 â”‚
â”‚ 15MB    â”‚ 15MB    â”‚ 15MB    â”‚ 10MB    â”‚
â”‚ é¡µ 1-50 â”‚ é¡µ51-100â”‚é¡µ101-125â”‚é¡µ126-150â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚         â”‚         â”‚         â”‚
     â–¼         â–¼         â–¼         â–¼
  Gemini    Gemini    Gemini    Gemini
  åˆ†æ 1    åˆ†æ 2    åˆ†æ 3    åˆ†æ 4
     â”‚         â”‚         â”‚         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            Manager Agent åˆå¹¶
            - ç´¯ç§¯æ‰€æœ‰æˆ·å‹
            - åˆå¹¶ä»˜æ¬¾è®¡åˆ’
            - å»é‡è®¾æ–½
            - æ•´åˆä¿¡æ¯
                    â”‚
                    â–¼
             âœ… å®Œæ•´æ•°æ®ï¼
```

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. æ™ºèƒ½åˆ†å—ç­–ç•¥

```typescript
// æŒ‰å¤§å°åˆ†å—
maxSize: 15MB per chunk (å®‰å…¨è¾¹é™…)

// æˆ–æŒ‰é¡µæ•°åˆ†å—
maxPages: 50 pages per chunk

// è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç­–ç•¥
if (fileSize > 20MB || pages > 100) {
  auto split!
}
```

### 2. Manager Agent çŠ¶æ€ç´¯ç§¯

```typescript
// Chunk 1 ç»“æœ
accumulatedData.units = [Unit1, Unit2, Unit3]

// Chunk 2 ç»“æœï¼ˆç´¯åŠ ï¼‰
accumulatedData.units = [Unit1, Unit2, Unit3, Unit4, Unit5]

// Chunk 3 ç»“æœï¼ˆç´¯åŠ ï¼‰
accumulatedData.units = [Unit1...Unit8]

// æœ€åå»é‡
uniqueUnits = deduplicate(accumulatedData.units)
```

### 3. å®æ—¶è¿›åº¦åé¦ˆ

```
è¿›åº¦: 10% - æ­£åœ¨åˆ†å‰² PDF...
è¿›åº¦: 20% - åˆ†æç¬¬ 1/4 æ‰¹ (é¡µ 1-50)
è¿›åº¦: 35% - åˆ†æç¬¬ 2/4 æ‰¹ (é¡µ 51-100)  â† å®æ—¶æ›´æ–°è¡¨å•ï¼
è¿›åº¦: 50% - åˆ†æç¬¬ 3/4 æ‰¹ (é¡µ 101-125)
è¿›åº¦: 65% - åˆ†æç¬¬ 4/4 æ‰¹ (é¡µ 126-150)
è¿›åº¦: 80% - åˆå¹¶æ‰€æœ‰æ•°æ®...
è¿›åº¦: 100% - å®Œæˆï¼
```

---

## ğŸ“Š å¤„ç†èƒ½åŠ›å¯¹æ¯”

| ç‰¹æ€§ | ä¹‹å‰ | ç°åœ¨ |
|------|------|------|
| å•æ–‡ä»¶å¤§å° | 20MB é™åˆ¶ | **æ— é™åˆ¶** âœ¨ |
| æ€»é¡µæ•° | ~100 é¡µ | **æ— é™åˆ¶** âœ¨ |
| å¤„ç†æ–¹å¼ | ä¸€æ¬¡æ€§ | åˆ†æ‰¹ + ç´¯ç§¯ |
| å¤šæ–‡æ¡£ | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| çŠ¶æ€ç®¡ç† | å•æ¬¡ | Manager ç´¯ç§¯ âœ¨ |
| å»é‡ | æ‰‹åŠ¨ | è‡ªåŠ¨ âœ¨ |

---

## ğŸ¬ å®é™…ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ï¼šä½ çš„æ–‡ä»¶

**æ–‡ä»¶ 1**: FloorPlans.pdf (39.6MB, ~100 é¡µ)
```
æ£€æµ‹åˆ°æ–‡ä»¶å¤ªå¤§
    â†“
è‡ªåŠ¨åˆ†å‰²æˆ 3 å—:
â”œâ”€ Chunk 1: é¡µ 1-50 (13MB)
â”œâ”€ Chunk 2: é¡µ 51-100 (13MB)
â””â”€ Chunk 3: é¡µ 101-... (13MB)
    â†“
æ‰¹é‡å¤„ç†:
â”œâ”€ Chunk 1 â†’ æå– 8 ä¸ªæˆ·å‹
â”œâ”€ Chunk 2 â†’ æå– 10 ä¸ªæˆ·å‹
â””â”€ Chunk 3 â†’ æå– 5 ä¸ªæˆ·å‹
    â†“
Manager åˆå¹¶:
â”œâ”€ æ€»å…± 23 ä¸ªæˆ·å‹
â”œâ”€ å»é‡å â†’ 15 ä¸ªå”¯ä¸€æˆ·å‹
â””â”€ æŒ‰ç±»åˆ«åˆ†ç»„ â†’ Studio(2), 1BR(5), 2BR(4), 3BR(3), Penthouse(1)
```

**æ–‡ä»¶ 2**: Project-Briefing.pdf (77.7MB, ~200 é¡µ)
```
è‡ªåŠ¨åˆ†å‰²æˆ 6 å—
    â†“
æ‰¹é‡å¤„ç†æ¯ä¸€å—
    â†“
æå–é¡¹ç›®ä¿¡æ¯ã€è®¾æ–½ã€ä»˜æ¬¾è®¡åˆ’
    â†“
åˆå¹¶åˆ°æ€»ç»“æœä¸­
```

### æœ€ç»ˆç»“æœ
```json
{
  "name": "The Edit at D3",
  "developer": "Meraas",
  "units": [
    // æ¥è‡ªä¸¤ä¸ªæ–‡æ¡£çš„æ‰€æœ‰æˆ·å‹ï¼Œå·²å»é‡
  ],
  "paymentPlans": [
    // æ¥è‡ªä»˜æ¬¾è®¡åˆ’æ–‡æ¡£
  ],
  "amenities": [
    // æ¥è‡ªæ‰€æœ‰æ–‡æ¡£ï¼Œå·²å»é‡
  ]
}
```

---

## ğŸ¨ æ–°çš„è¿›åº¦æ˜¾ç¤º

### å¤§æ–‡ä»¶å¤„ç†è¿›åº¦

```
0-10%:  æ£€æµ‹æ–‡ä»¶å¤§å°
10-15%: åˆ†å‰²æˆ 4 å—
15-30%: å¤„ç†ç¬¬ 1 æ‰¹ (é¡µ 1-50)
30-45%: å¤„ç†ç¬¬ 2 æ‰¹ (é¡µ 51-100)
45-60%: å¤„ç†ç¬¬ 3 æ‰¹ (é¡µ 101-150)
60-75%: å¤„ç†ç¬¬ 4 æ‰¹ (é¡µ 151-200)
75-85%: Manager åˆå¹¶æ•°æ®
85-95%: å»é‡å’Œåˆ†ç»„
95-100%: ç”ŸæˆæŠ¥å‘Š
```

ç”¨æˆ·å¯ä»¥**å®æ—¶çœ‹åˆ°**ï¼š
- å½“å‰å¤„ç†ç¬¬å‡ æ‰¹
- é¡µç èŒƒå›´
- å·²ç´¯ç§¯çš„æˆ·å‹æ•°é‡

---

## ğŸ“¦ ä¾èµ–è¯´æ˜

### pdf-lib âœ…
```bash
npm install pdf-lib
```

**ä¸ºä»€ä¹ˆç”¨ pdf-libï¼Ÿ**
- âœ… **æ— éœ€ canvas** - çº¯ JS å®ç°
- âœ… Windows å®Œç¾è¿è¡Œ
- âœ… å¯ä»¥åˆ†å‰²/åˆå¹¶ PDF
- âœ… å¯ä»¥æå–é¡µé¢
- âœ… è½»é‡çº§ï¼ˆ1MBï¼‰

---

## ğŸ§ª æµ‹è¯•ä½ çš„å¤§æ–‡ä»¶

### ç°åœ¨å¯ä»¥å¤„ç†äº†ï¼

1. **ä¸Šä¼ ä½ çš„ 77MB PDF**
2. ç³»ç»Ÿè‡ªåŠ¨ï¼š
   - æ£€æµ‹æ–‡ä»¶å¤ªå¤§
   - åˆ†å‰²æˆ 5-6 ä¸ªå—
   - æ‰¹é‡å¤„ç†æ¯ä¸€å—
   - Manager ç´¯ç§¯çŠ¶æ€
   - åˆå¹¶å»é‡
3. å‰ç«¯å®æ—¶çœ‹åˆ°è¿›åº¦ï¼š
   ```
   10% - åˆ†å‰² PDF (6 å—)
   25% - åˆ†æç¬¬ 1/6 æ‰¹...
   40% - åˆ†æç¬¬ 2/6 æ‰¹... â† è¡¨å•å¼€å§‹å¡«å……
   55% - åˆ†æç¬¬ 3/6 æ‰¹... â† æˆ·å‹é€æ­¥å¢åŠ 
   70% - åˆ†æç¬¬ 4/6 æ‰¹...
   80% - åˆå¹¶æ•°æ®...
   100% - å®Œæˆï¼
   ```

---

## ğŸ¯ Manager Agent çš„ä½œç”¨

### çŠ¶æ€ç´¯ç§¯é€»è¾‘

```typescript
class ManagerAgent {
  accumulatedState = {
    units: [],
    paymentPlans: [],
    amenities: [],
  }

  // å¤„ç†æ¯ä¸ª chunk
  processChunk(chunkResult) {
    // ç´¯ç§¯æˆ·å‹
    this.accumulatedState.units.push(...chunkResult.units)
    
    // ç´¯ç§¯ä»˜æ¬¾è®¡åˆ’
    this.accumulatedState.paymentPlans.push(...chunkResult.paymentPlans)
    
    // ç´¯ç§¯è®¾æ–½
    chunkResult.amenities.forEach(a => {
      if (!this.accumulatedState.amenities.includes(a)) {
        this.accumulatedState.amenities.push(a)
      }
    })
  }

  // æœ€åå»é‡
  deduplicate() {
    this.accumulatedState.units = removeDuplicates(
      this.accumulatedState.units
    )
  }
}
```

---

## ğŸ’¡ å»é‡ç­–ç•¥

### æˆ·å‹å»é‡

```typescript
// å»é‡é”®: category + typeName
"1BR_Type A" â†’ åªä¿ç•™ä¸€ä¸ª
"1BR_Type B" â†’ åªä¿ç•™ä¸€ä¸ª
"2BR_Corner" â†’ åªä¿ç•™ä¸€ä¸ª

// å¦‚æœé‡å¤ï¼Œåˆå¹¶æ•°æ®
if (duplicate) {
  merge unit numbers: [101,201] + [301,401] = [101,201,301,401]
  add unit counts: 5 + 3 = 8
  prefer non-null values for other fields
}
```

---

## ğŸ‰ æœ€ç»ˆæ•ˆæœ

### å¤„ç†ä½ çš„æ–‡ä»¶

**ä¹‹å‰**ï¼š
```
âŒ 77MB PDF â†’ Gemini 400 Error
âŒ æ— æ³•å¤„ç†å¤§æ–‡ä»¶
```

**ç°åœ¨**ï¼š
```
âœ… 77MB PDF â†’ è‡ªåŠ¨åˆ†å‰²æˆ 6 å—
âœ… æ‰¹é‡å¤„ç†: Chunk1 â†’ Chunk2 â†’ Chunk3 â†’ ...
âœ… Manager ç´¯ç§¯: 23 units â†’ å»é‡ â†’ 15 unique units
âœ… æŒ‰ç±»åˆ«åˆ†ç»„: Studio(2), 1BR(5), 2BR(4)...
âœ… å®Œæ•´æ•°æ®è¿”å›ï¼
```

---

## ğŸš€ ç«‹å³æµ‹è¯•

### è®¿é—®é¡µé¢
```
http://localhost:5173/developer/upload
```

### ä¸Šä¼ ä½ çš„å¤§æ–‡ä»¶
1. ç‚¹å‡»ä¸Šä¼ 
2. æŒ‰ä½ **Ctrl** é€‰æ‹©å¤šä¸ªæ–‡ä»¶ï¼ˆåŒ…æ‹¬å¤§æ–‡ä»¶ï¼ï¼‰
3. ç‚¹å‡»"AI æ™ºèƒ½æå–"
4. è§‚å¯Ÿï¼š
   - ğŸ” è‡ªåŠ¨æ£€æµ‹æ–‡ä»¶å¤§å°
   - ğŸ“¦ å¤§æ–‡ä»¶è‡ªåŠ¨åˆ†å—
   - ğŸ”„ æ‰¹é‡å¤„ç†è¿›åº¦
   - ğŸ“Š å®æ—¶ç´¯ç§¯æ•°æ®åˆ°è¡¨å•
   - âœ… æœ€ç»ˆåˆå¹¶å®Œæˆï¼

---

## ğŸ“Š æ€§èƒ½ä¼°ç®—

| æ–‡ä»¶å¤§å° | åˆ†å—æ•° | å¤„ç†æ—¶é—´ | è¯´æ˜ |
|---------|--------|---------|------|
| < 20MB | 1 | 20-40s | ç›´æ¥å¤„ç† |
| 20-40MB | 2-3 | 40-80s | åˆ†2-3æ‰¹ |
| 40-80MB | 3-6 | 80-150s | åˆ†3-6æ‰¹ |
| 80-100MB | 6-8 | 150-200s | åˆ†6-8æ‰¹ |

**ä½ çš„æ–‡ä»¶**ï¼š
- 77MB â†’ çº¦ 5-6 å— â†’ çº¦ 2-3 åˆ†é’Ÿ

---

## âœ… å®Œæˆæ¸…å•

- [x] PDF åˆ†å—å·¥å…·ï¼ˆpdf-libï¼‰
- [x] è‡ªåŠ¨å¤§å°æ£€æµ‹
- [x] æ‰¹é‡å¤„ç†æ‰§è¡Œå™¨
- [x] Manager çŠ¶æ€ç´¯ç§¯
- [x] æ™ºèƒ½å»é‡åˆå¹¶
- [x] å®æ—¶è¿›åº¦æ›´æ–°
- [x] å¤šæ–‡ä»¶æ”¯æŒ
- [x] å‰ç«¯å¤šé€‰åŠŸèƒ½

**ç³»ç»Ÿç°åœ¨å¯ä»¥å¤„ç†ä»»æ„å¤§å°çš„ PDFï¼** ğŸŠ

---

**å†è¯•ä¸€æ¬¡ï¼Œè¿™æ¬¡åº”è¯¥æˆåŠŸäº†ï¼** ğŸš€